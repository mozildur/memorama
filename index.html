<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>üß† Memorama del Esp√≠ritu Santo</title>
  <meta name="color-scheme" content="light dark" />
  <style>
    :root{
      --bg: linear-gradient(to bottom, #ede7f6, #fff);
      --fg: #4e3e65;
      --accent: #7e57c2;
      --accent-2: #9575cd;
      --card-front: #b39ddb;
      --space: clamp(10px, 2.5vmin, 20px);
      --radius: 12px;
      --shadow: 0 4px 10px rgba(0,0,0,.12);
      --fs-body: clamp(14px, 1.3vw, 18px);
      --fs-h1: clamp(22px, 3.5vw, 34px);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: system-ui, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      font-size: var(--fs-body);
      line-height:1.45;
      color: var(--fg);
      background: var(--bg);
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    .container{
      max-width: min(1100px, 100% - 2*var(--space));
      margin-inline: auto;
      padding: var(--space);
      text-align: center;
    }

    h1{
      margin: calc(var(--space) * 1.2) 0 var(--space) 0;
      font-size: var(--fs-h1);
    }

    p.lead{margin:0 auto var(--space); max-width:65ch}

    #controls{
      display:flex;
      flex-wrap:wrap;
      gap: var(--space);
      justify-content:center;
      align-items:center;
      margin-top: var(--space);
    }

    select, button{
      font: inherit;
      padding: .65em 1em;
      border-radius: 10px;
      border: 1px solid color-mix(in oklab, var(--accent), black 15%);
      cursor: pointer;
      box-shadow: var(--shadow);
      background: var(--accent);
      color: #fff;
      min-height: 44px; /* objetivo t√°ctil accesible */
      touch-action: manipulation;
    }
    select{background: #fff; color: var(--fg)}
    button#restart{background: var(--accent); border-color: transparent}
    button#restart:hover{filter: brightness(.95)}

    /* Info row */
    .info{ display:flex; flex-wrap:wrap; gap: .75rem; justify-content:center; margin-top:.5rem }
    .pill{ padding: .4rem .7rem; border-radius: 999px; background: #fff; box-shadow: var(--shadow); }

    /* Game grid */
    #game{
      display:grid;
      gap: clamp(8px, 1.6vmin, 14px);
      grid-template-columns: repeat(auto-fit, minmax(96px, 1fr));
      max-width: min(720px, 100%);
      margin: calc(var(--space) * 1.6) auto;
    }

    .card{
      aspect-ratio: 2 / 3; /* se adapta solo a cualquier ancho */
      perspective: 1000px;
      cursor: pointer;
      position: relative;
      -webkit-tap-highlight-color: transparent;
      outline: none;
      border-radius: var(--radius);
    }
    .card:focus-visible{ box-shadow: 0 0 0 3px color-mix(in oklab, var(--accent), white 30%); }

    .card-inner{
      position:absolute; inset:0;
      transform-style: preserve-3d;
      transition: transform .6s;
      border-radius: var(--radius);
    }
    .card.flipped .card-inner{ transform: rotateY(180deg); }

    .face{
      position:absolute; inset:0;
      display:grid; place-items:center;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      font-weight: 700; font-size: clamp(14px, 2.4vmin, 20px);
      backface-visibility: hidden;
      -webkit-backface-visibility: hidden;
      padding: .6rem;
      text-wrap: balance;
    }
    .card-front{ background: var(--card-front); color:#fff }
    .card-back{ background: var(--accent-2); color:#fff; transform: rotateY(180deg) }

    .matched{ pointer-events:none; opacity:.55; }

    #message{ min-height:1.2em }

    footer{
      margin: calc(var(--space) * 2) auto;
      font-size: .95em;
      color: color-mix(in oklab, var(--fg), #000 20%);
    }
    footer a{ color: inherit }

    /* Dark mode */
    @media (prefers-color-scheme: dark){
      :root{
        --bg: linear-gradient(to bottom, #0f0b17, #0b0b0f);
        --fg: #efe9ff;
        --accent: #6f53c7;
        --accent-2: #5f45b8;
        --card-front: #7b68d1;
        --shadow: 0 4px 10px rgba(0,0,0,.35);
      }
      select{background:#131221; color: var(--fg); border-color:#2a2750}
      .pill{ background:#131221 }
    }

    /* Reduce motion */
    @media (prefers-reduced-motion: reduce){
      .card-inner{ transition: none }
    }

    /* Slightly denser grid on big screens */
    @media (min-width: 900px){
      #game{ grid-template-columns: repeat(auto-fit, minmax(110px, 1fr)); max-width: 820px }
    }
  </style>
</head>
<body>
  <main class="container">
    <h1>üß† Memorama del Esp√≠ritu Santo</h1>
    <p class="lead">Encuentra los pares de conceptos de <strong>Un Curso de Milagros</strong> y deja que el recuerdo de la Verdad se revele. ‚ú®</p>

    <div id="controls" role="group" aria-label="Controles del juego">
      <label for="difficulty">Nivel:</label>
      <select id="difficulty" name="difficulty" aria-label="Selecciona dificultad">
        <option value="4">F√°cil (4 pares)</option>
        <option value="6">Intermedio (6 pares)</option>
        <option value="8" selected>Avanzado (8 pares)</option>
      </select>
      <button id="restart" type="button">üîÑ Reiniciar juego</button>
    </div>

    <div class="info" aria-live="polite">
      <span id="score" class="pill">Puntaje: 0</span>
      <span id="timer" class="pill">‚è±Ô∏è Tiempo: 00:00</span>
      <span id="highscore" class="pill">üèÜ Mejor puntaje: 0</span>
    </div>

    <section id="game" aria-label="Tablero de cartas" aria-live="polite"></section>

    <p id="message" aria-live="polite"></p>
    <p id="summary"></p>

    <audio id="successSound" preload="auto" src="https://cdn.pixabay.com/audio/2022/03/15/audio_9e9e5c2b74.mp3"></audio>
    <audio id="winSound" preload="auto" src="https://cdn.pixabay.com/audio/2021/08/09/audio_c8972b8897.mp3"></audio>
    <audio id="failSound" preload="auto" src="https://cdn.pixabay.com/audio/2022/03/23/audio_e1e1e5b8bb.mp3"></audio>

    <footer>
      Hecho con milagros, risas y c√≥digo por <strong>MoZ ‚ú®</strong><br>
      Inspirado en <em>Un Curso de Milagros</em> y los recordatorios del Esp√≠ritu Santo.<br>
      Sonidos de <a href="https://pixabay.com/es/" target="_blank" rel="noopener noreferrer">Pixabay</a>.
    </footer>
  </main>

  <script>
    const terms = [
      "Perd√≥n", "Paz", "Ego", "Milagro", "Expiaci√≥n", "Amor", "Santidad", "Unidad",
      "Verdad", "Juicio", "Mente", "Luz", "Gu√≠a", "Cristo", "Ilusi√≥n", "Gratitud"
    ];

    const $ = (sel, root=document) => root.querySelector(sel);
    const $$ = (sel, root=document) => Array.from(root.querySelectorAll(sel));

    let flipped = [];
    let matched = 0;
    let score = 0;
    let totalPairs = 8;
    let timerInterval; let seconds = 0; let gameOver = false;

    const elGame = $("#game");
    const elScore = $("#score");
    const elTimer = $("#timer");
    const elHigh = $("#highscore");
    const elMsg = $("#message");
    const elSummary = $("#summary");
    const elRestart = $("#restart");
    const elDiff = $("#difficulty");

    const sfx = {
      ok: $("#successSound"),
      win: $("#winSound"),
      fail: $("#failSound"),
    };

    function fmtTime(s){
      const m = Math.floor(s/60).toString().padStart(2, '0');
      const r = (s%60).toString().padStart(2, '0');
      return `${m}:${r}`;
    }

    function startTimer(){
      clearInterval(timerInterval);
      seconds = 0; elTimer.textContent = `‚è±Ô∏è Tiempo: ${fmtTime(seconds)}`;
      timerInterval = setInterval(()=>{
        seconds++; elTimer.textContent = `‚è±Ô∏è Tiempo: ${fmtTime(seconds)}`;
      }, 1000);
    }
    function stopTimer(){ clearInterval(timerInterval); }

    function startGame(){
      gameOver = false;
      totalPairs = parseInt(elDiff.value, 10);
      elGame.innerHTML = "";
      flipped = []; matched = 0; score = 0;
      elScore.textContent = "Puntaje: 0";
      elMsg.textContent = ""; elSummary.textContent = "";

      startTimer();
      const selected = [...terms].sort(()=> Math.random() - .5).slice(0, totalPairs);
      const deck = [...selected, ...selected].sort(()=> Math.random() - .5);

      for(const text of deck){
        const card = document.createElement('button');
        card.type = 'button';
        card.className = 'card';
        card.setAttribute('aria-label', 'Carta');
        card.innerHTML = `
          <div class="card-inner">
            <div class="face card-front">?</div>
            <div class="face card-back">${text}</div>
          </div>`;
        card.dataset.value = text;
        elGame.appendChild(card);
      }

      const high = parseInt(localStorage.getItem('memoramaHighscore') || 0, 10);
      elHigh.textContent = `üèÜ Mejor puntaje: ${high}`;
    }

    // Delegaci√≥n de eventos para mejor rendimiento
    elGame.addEventListener('click', (ev)=>{
      const card = ev.target.closest('.card');
      if(!card || gameOver) return;
      flipCard(card);
    });

    function flipCard(card){
      if(card.classList.contains('flipped')) return;
      if(flipped.length === 2) return;

      card.classList.add('flipped');
      flipped.push(card);

      if(flipped.length === 2){
        const [a,b] = flipped;
        const match = a.dataset.value === b.dataset.value;
        if(match){
          sfx.ok.currentTime = 0; sfx.ok.play().catch(()=>{});
          matched++; score += 10;
          a.classList.add('matched'); b.classList.add('matched');
          flipped = [];
        } else {
          sfx.fail.currentTime = 0; sfx.fail.play().catch(()=>{});
          setTimeout(()=>{
            a.classList.remove('flipped');
            b.classList.remove('flipped');
            flipped = [];
          }, 800);
        }
        elScore.textContent = `Puntaje: ${score}`;
      }

      if(matched === totalPairs && !gameOver){
        gameOver = true;
        stopTimer();
        sfx.win.currentTime = 0; sfx.win.play().catch(()=>{});
        const mensaje = `üéâ ¬°Completaste el juego con ${score} puntos en ${seconds} segundos! Rango: ${getRank(score)}`;
        elMsg.textContent = "¬°Has encontrado todos los pares! üß†‚ú®";
        elSummary.textContent = mensaje;

        const prev = parseInt(localStorage.getItem('memoramaHighscore') || 0, 10);
        if(score > prev){
          localStorage.setItem('memoramaHighscore', String(score));
          elHigh.textContent = `üèÜ Nuevo r√©cord: ${score}`;
        }
      }
    }

    function getRank(score){
      if (score >= 80) return "üü£ Fray Barucio Legendario";
      if (score >= 60) return "üîµ Cristo Ninja";
      if (score >= 40) return "üü¢ Estudiante Avanzado";
      if (score >= 20) return "üü° Milagronauta en Pr√°ctica";
      return "üî¥ Ego en modo Archibaldo";
    }

    elRestart.addEventListener('click', startGame);
    window.addEventListener('load', startGame);
  </script>
</body>
</html>
